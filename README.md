## SaveMesh plug-in

This is an `AutoDesk` `Fusion 360` plug-in, designed to save a mesh, generated by `Fusion 360` to the `.msh` format file.

TODO: link to GmshDefines.h

### Deploying the plug-in

The plug-in could be created according to the instructions:

https://help.autodesk.com/view/fusion360/ENU/?guid=GUID-9701BBA7-EC0E-4016-A9C8-964AA4838954

Choose to create an `Add-in`, language `C++`, name `SaveMesh`.
Then the folder `C:\Users\%USERNAME%\AppData\Roaming\Autodesk\Autodesk Fusion 360\API\AddIns\SaveMesh`
could be deleted and the repository `https://github.com/mingiss/SaveMesh.git` cloned instead of it.

    git clone https://github.com/mingiss/SaveMesh.git

Alternativelly, simply the file `https://github.com/mingiss/SaveMesh/blob/master/SaveMesh.dll` could be copied over the generated one.
The plug-in has no user interface, the mesh of the currently active document is periodically (every 3 seconds) autosaved to the file
`C:\Users\%USERNAME%\AppData\Roaming\Autodesk\Autodesk Fusion 360\API\AddIns\SaveMesh\SaveMesh_triangle.msh`.


### Terms explained

- `Nodes` / points &ndash; triplets of coordinates of all vertices of polygons of the mesh.

- `Elements` &ndash; polygons of the mesh, referencing to the vertex points through their tags &ndash; integer order numbers.

- `Entity` &ndash; group of `nodes` or `elements`, stored in the mesh file as a separate chunk.
  `Entities` correspond to the vectors of points and triangles / quads / polygons, obtained through getters of `TriangleMesh` or `PolygonMesh` classes.
  Look `AutoDesk` `Fusion 360` `API Reference Manual` for details:

  https://help.autodesk.com/view/fusion360/ENU/?guid=GUID-d5d12829-8431-4588-9c7f-045fa6cd611c
  https://help.autodesk.com/view/fusion360/ENU/?guid=GUID-9d1f8c7d-8f3c-44f6-9999-906199fc99f6
  https://help.autodesk.com/cloudhelp/ENU/Fusion-360-API/images/Fusion.pdf

The saving of the mesh is done in three passes.
First of all, mesh structures are scanned and counts of all `nodes`, `elements` and `entities`, necessary for the headers of the `.msh` file, calculated.
After that, all `nodes` are stored to the `entities` of the `$Nodes` section.
The last pass stores all `element` `entities` to the section `$Elements`.
Look to the `.msh` file structure for details:

http://gmsh.info/doc/texinfo/gmsh.html#MSH-file-format


### Building of the plug-in

The plug-in could be built using the `MS Visual Studio Community` `IDE`.
It could be downloaded from here:

https://visualstudio.microsoft.com/vs/community/

For the compilation of the project file `SaveMesh.vcxproj` open it, using the `MS Visual Studio Community`,
and press the menu item `Build/Build Solution`.


### Testing procedure

The following test data files are provided in the repository:

- `1.71_1.78_1.85 GHz_Single Element.step` &ndash; input file with the model for mesh generation;
- `SaveMesh_polygon.msh` and `SaveMesh_triangle.msh` &ndash; result files of the ordinary test;
- `SaveMesh_polygon_3x.msh` and `SaveMesh_triangle_3x.msh` &ndash; result files of enhanced test.

The test procedure:

- Start `Fusion 360`,
- Open the file `1.71_1.78_1.85 GHz_Single Element.step`,
- Generate the mesh with 20 mm grid:
    - `MESH` tab
    - `BRep to Mesh` (the second button on the toolbar)
    - click the cube
    - `Maximum edge length` &ndash; enter slider value "20 mm" using the keyboard
    - `OK`
- Start the plug-in `SaveMesh`:
    - `TOOLS` tab
    - `ADD-INS` (the second buton on the toolbar)
    - `Add-Ins` tab
    - `SaveMesh`
    - `Run`
- After ~6 sec close the Fusion.
    `SaveMesh_polygon.msh` and `SaveMesh_triangle.msh` should be renewed, but unchanged.

There is implemented a second test for deeper `.msh` file structure investigation &ndash;
all information in Fusion 360 mesh structures is tripled, multiplying point coordinates by decreasing factor.
The resulting mesh is saved as three meshes of different sizes in the same output files
`SaveMesh_polygon_3x.msh` and `SaveMesh_triangle_3x.msh`.
To run the enhanced test, the plug-in should be recompiled with enhanced testing mode switched on &ndash;
the following line in the file `MeshSaver.h` should be uncommented:

    #define TRIPLE_TEST

Don't forget recompile the project without the `TRIPLE_TEST` flag, after you are done with the test.
